---
title: Cleaning the Metropolitan Museum of Art
author: ~
date: '2017-12-26'
slug: wtfdata
categories: [data cleaning, exploratory analysis]
tags: [cleaning, wtfdata, legacy data]
---



<p>Recently, <a href="http://metmuseum.org">The Metropolitan Museum of Art</a> made its collection database publicly available. The collection spans over 5,000 years and has nearly a half-million records. Wonderful! Exciting!</p>
<p>43 Variables, almost all of them text.</p>
<pre class="r"><code>library(tidyverse)
library(RColorBrewer)

#read in the 227 MB file
#trim the white space to avoid weird UTF/ASCII characters
MetObjects&lt;-read_csv(&quot;http://media.githubusercontent.com/media/metmuseum/openaccess/master/MetObjects.csv&quot;, trim_ws = T)

#display the column names
names(MetObjects)</code></pre>
<pre><code>##  [1] &quot;Object Number&quot;           &quot;Is Highlight&quot;           
##  [3] &quot;Is Public Domain&quot;        &quot;Object ID&quot;              
##  [5] &quot;Department&quot;              &quot;Object Name&quot;            
##  [7] &quot;Title&quot;                   &quot;Culture&quot;                
##  [9] &quot;Period&quot;                  &quot;Dynasty&quot;                
## [11] &quot;Reign&quot;                   &quot;Portfolio&quot;              
## [13] &quot;Artist Role&quot;             &quot;Artist Prefix&quot;          
## [15] &quot;Artist Display Name&quot;     &quot;Artist Display Bio&quot;     
## [17] &quot;Artist Suffix&quot;           &quot;Artist Alpha Sort&quot;      
## [19] &quot;Artist Nationality&quot;      &quot;Artist Begin Date&quot;      
## [21] &quot;Artist End Date&quot;         &quot;Object Date&quot;            
## [23] &quot;Object Begin Date&quot;       &quot;Object End Date&quot;        
## [25] &quot;Medium&quot;                  &quot;Dimensions&quot;             
## [27] &quot;Credit Line&quot;             &quot;Geography Type&quot;         
## [29] &quot;City&quot;                    &quot;State&quot;                  
## [31] &quot;County&quot;                  &quot;Country&quot;                
## [33] &quot;Region&quot;                  &quot;Subregion&quot;              
## [35] &quot;Locale&quot;                  &quot;Locus&quot;                  
## [37] &quot;Excavation&quot;              &quot;River&quot;                  
## [39] &quot;Classification&quot;          &quot;Rights and Reproduction&quot;
## [41] &quot;Link Resource&quot;           &quot;Metadata Date&quot;          
## [43] &quot;Repository&quot;</code></pre>
<p>43 variables with “spacey” names.</p>
<p>Before we go any further, we need to transform the names to valid, R-friendly variable names. I prefer to use lowercase for column names.</p>
<pre class="r"><code>#use base &quot;make.names&quot; function on lowercase column names
head(names(MetObjects)&lt;-make.names(tolower(names(MetObjects))),6)</code></pre>
<pre><code>## [1] &quot;object.number&quot;    &quot;is.highlight&quot;     &quot;is.public.domain&quot;
## [4] &quot;object.id&quot;        &quot;department&quot;       &quot;object.name&quot;</code></pre>
<p>Now we can take a peek at what the data includes using dplyr’s glimpse()</p>
<pre class="r"><code>glimpse(MetObjects,width = 75)</code></pre>
<pre><code>## Observations: 458,614
## Variables: 43
## $ object.number           &lt;chr&gt; &quot;1979.486.1&quot;, &quot;1980.264.5&quot;, &quot;67.265.9&quot;...
## $ is.highlight            &lt;chr&gt; &quot;False&quot;, &quot;False&quot;, &quot;False&quot;, &quot;False&quot;, &quot;F...
## $ is.public.domain        &lt;chr&gt; &quot;False&quot;, &quot;False&quot;, &quot;False&quot;, &quot;False&quot;, &quot;F...
## $ object.id               &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,...
## $ department              &lt;chr&gt; &quot;American Decorative Arts&quot;, &quot;American ...
## $ object.name             &lt;chr&gt; &quot;Coin&quot;, &quot;Coin&quot;, &quot;Coin&quot;, &quot;Coin&quot;, &quot;Coin&quot;...
## $ title                   &lt;chr&gt; &quot;One-dollar Liberty Head Coin&quot;, &quot;Ten-d...
## $ culture                 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ period                  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ dynasty                 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ reign                   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ portfolio               &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ artist.role             &lt;chr&gt; &quot;Maker&quot;, &quot;Maker&quot;, NA, NA, NA, NA, NA, ...
## $ artist.prefix           &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ artist.display.name     &lt;chr&gt; &quot;James Barton Longacre&quot;, &quot;Christian Go...
## $ artist.display.bio      &lt;chr&gt; &quot;American, Delaware County, Pennsylvan...
## $ artist.suffix           &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ artist.alpha.sort       &lt;chr&gt; &quot;Longacre, James Barton&quot;, &quot;Gobrecht, C...
## $ artist.nationality      &lt;chr&gt; &quot;American&quot;, NA, NA, NA, NA, NA, NA, NA...
## $ artist.begin.date       &lt;chr&gt; &quot;1794&quot;, &quot;1785&quot;, NA, NA, NA, NA, NA, NA...
## $ artist.end.date         &lt;chr&gt; &quot;1869&quot;, &quot;1844&quot;, NA, NA, NA, NA, NA, NA...
## $ object.date             &lt;chr&gt; &quot;1853&quot;, &quot;1901&quot;, &quot;190927&quot;, &quot;190927&quot;, ...
## $ object.begin.date       &lt;int&gt; 1853, 1901, 1909, 1909, 1909, 1909, 19...
## $ object.end.date         &lt;int&gt; 1853, 1901, 1927, 1927, 1927, 1927, 19...
## $ medium                  &lt;chr&gt; &quot;Gold&quot;, &quot;Gold&quot;, &quot;Gold&quot;, &quot;Gold&quot;, &quot;Gold&quot;...
## $ dimensions              &lt;chr&gt; &quot;Dimensions unavailable&quot;, &quot;Dimensions ...
## $ credit.line             &lt;chr&gt; &quot;Gift of Heinz L. Stoppelmann, 1979&quot;, ...
## $ geography.type          &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ city                    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ state                   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ county                  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ country                 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ region                  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ subregion               &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ locale                  &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ locus                   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ excavation              &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ river                   &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ classification          &lt;chr&gt; &quot;Metal&quot;, &quot;Metal&quot;, &quot;Metal&quot;, &quot;Metal&quot;, &quot;M...
## $ rights.and.reproduction &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA...
## $ link.resource           &lt;chr&gt; &quot;http://www.metmuseum.org/art/collecti...
## $ metadata.date           &lt;chr&gt; &quot;12/25/2017 8:00:01 AM&quot;, &quot;12/25/2017 8...
## $ repository              &lt;chr&gt; &quot;Metropolitan Museum of Art, New York,...</code></pre>
<p>There are quite a few NAs in several of the columns, so the next step would be to check the sparsity of each column and decide whether we can drop it. We can do this by adding up the null entries with sum(is.na()) and dividing it by the number of records.</p>
<p>I’m going to select those variables that are complete and hold them in a separate table as I explore the data further and break it into more manageable chunks.</p>
<pre class="r"><code>#create a function to find out what variables are completely filled in, suggesting these were required fields during data entry
complete&lt;-function(x) sum(is.na(x))==0

#select those columns that are complete and hold as a separate table
mo_complete&lt;-MetObjects %&gt;% 
  select_if(.,complete)

names(mo_complete)</code></pre>
<pre><code>##  [1] &quot;object.number&quot;     &quot;is.highlight&quot;      &quot;is.public.domain&quot; 
##  [4] &quot;object.id&quot;         &quot;department&quot;        &quot;object.begin.date&quot;
##  [7] &quot;object.end.date&quot;   &quot;link.resource&quot;     &quot;metadata.date&quot;    
## [10] &quot;repository&quot;</code></pre>
<p>And now a plot…Which departments are the largest? While we’re at it, let’s see how the public domain vs. non-public domain breaks down.</p>
<pre class="r"><code>library(forcats)
mo_complete %&gt;%
  group_by(department, is.public.domain) %&gt;% 
  count() %&gt;% 
  ggplot(aes(x=fct_reorder(department,n, decreasing=TRUE), y=n))+
  geom_col(aes(fill=is.public.domain))+
  labs(x=&quot;&quot;, y=&quot;number of objects&quot;, fill=&quot;is in\npublic domain&quot;)+
  theme_bw()+
  coord_flip()</code></pre>
<p><img src="/posts/2017-12-22-wtfdata_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Drawings and Prints is by far the largest department, containing a full 35% of the records in the MetObjects table.</p>
<p>Let’s explore Drawings and Prints a bit more. First, let’s find out if there are any additional complete variables when we filter on department==“Drawings and Prints”</p>
<pre class="r"><code>d_and_p_complete&lt;-mo_complete %&gt;% filter(department == &quot;Drawings and Prints&quot;) %&gt;% distinct() %&gt;% 
  left_join(MetObjects) %&gt;% 
  select_if(.,complete)

names(d_and_p_complete)[!names(d_and_p_complete) %in% names(mo_complete)]</code></pre>
<pre><code>## [1] &quot;classification&quot;</code></pre>
<p>Only one additional variable, classification, has complete data.</p>
<p>To capture more data, we’ll include any variable that is more than 75% complete:</p>
<pre class="r"><code>d_and_p_row_count&lt;-nrow(d_and_p_complete)
near_complete&lt;-function(x) sum(!is.na(x))/nrow(d_and_p_complete) &gt; 0.75

d_and_p&lt;-mo_complete %&gt;% filter(department == &quot;Drawings and Prints&quot;) %&gt;% 
  distinct() %&gt;% 
  left_join(MetObjects) %&gt;% 
  select_if(., near_complete)</code></pre>
<pre><code>## Joining, by = c(&quot;object.number&quot;, &quot;is.highlight&quot;, &quot;is.public.domain&quot;, &quot;object.id&quot;, &quot;department&quot;, &quot;object.begin.date&quot;, &quot;object.end.date&quot;, &quot;link.resource&quot;, &quot;metadata.date&quot;, &quot;repository&quot;)</code></pre>
<pre class="r"><code>names(d_and_p)</code></pre>
<pre><code>##  [1] &quot;object.number&quot;       &quot;is.highlight&quot;        &quot;is.public.domain&quot;   
##  [4] &quot;object.id&quot;           &quot;department&quot;          &quot;object.begin.date&quot;  
##  [7] &quot;object.end.date&quot;     &quot;link.resource&quot;       &quot;metadata.date&quot;      
## [10] &quot;repository&quot;          &quot;object.name&quot;         &quot;title&quot;              
## [13] &quot;artist.role&quot;         &quot;artist.display.name&quot; &quot;artist.display.bio&quot; 
## [16] &quot;artist.alpha.sort&quot;   &quot;artist.begin.date&quot;   &quot;artist.end.date&quot;    
## [19] &quot;object.date&quot;         &quot;medium&quot;              &quot;dimensions&quot;         
## [22] &quot;credit.line&quot;         &quot;classification&quot;</code></pre>
<p>I’d like to explore the media used to create the objects in the Drawings and Prints department. Unfortunately, the variable is filled with inconsistent or combined data, such as media and ground, color information, etc. Using tidytext, we can find the most frequent words used to describe the media. We’ve stemmed the words to avoid variations such as “etched/etch/etching”</p>
<p>First a table:</p>
<pre class="r"><code>library(tidytext)
library(SnowballC)
sw&lt;-stop_words
tidy_medium&lt;-d_and_p %&gt;% 
  ungroup() %&gt;% 
  # group_by(department) %&gt;% 
  unnest_tokens(word, medium) %&gt;% 
  mutate(word = wordStem(word)) %&gt;% 
  group_by(word) %&gt;% 
  summarise(freq=n()) %&gt;%
  ungroup() %&gt;% 
  anti_join(stop_words) %&gt;% 
  filter(!word %in% c(&quot;color&quot;, &quot;black&quot;, &quot;brown&quot;, &quot;white&quot;, &quot;green&quot;, &quot;dark&quot;, &quot;light&quot;, &quot;commerci&quot;)) %&gt;% 
    arrange(desc(freq))


head(tidy_medium, 10)</code></pre>
<pre><code>## # A tibble: 10 x 2
##          word  freq
##         &lt;chr&gt; &lt;int&gt;
##  1 lithograph 39832
##  2       etch 37214
##  3     engrav 27434
##  4        ink 16878
##  5        pen 11991
##  6 photograph 11680
##  7    albumen 11297
##  8      paper  8325
##  9    graphit  7768
## 10    woodcut  7075</code></pre>
<p>And then a wordcloud of the most frequent words describing the objects’ media:</p>
<pre class="r"><code>library(wordcloud)

tidy_medium %&gt;% 
  with(wordcloud(words = word, freq=freq, max.words=50, colors = brewer.pal(4, &quot;RdBu&quot;)))</code></pre>
<p><img src="/posts/2017-12-22-wtfdata_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
